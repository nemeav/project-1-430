<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1 Milestone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Philosopher:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">


    <script>
        // had to leave script here bc eslint was error checking no matter where i put it
        // fetch
        const handleResponse = async (response, section) => {
            const content = document.querySelector(`${section}`);
            const resText = await response.text();
            // handle page based on response
            if (response.status !== 204) {
                const parsedResponse = JSON.parse(resText);
            }
            content.innerHTML = '';

            // header titles based on status code
            switch (response.status) {
                case 200:
                    // if keys = 3 or 7-9, print entire response
                    // 7-9 for each key held by char info (getRandom), 3 for the keys in char's talents
                    // 7 = standard, 8 = w/ add'l archon or alternate names key, 9 = both mentioned in 8
                    if (Object.keys(parsedResponse).length <= 9 && Object.keys(parsedResponse).length >= 7 || Object.keys(parsedResponse).length === 3 || Object.keys(parsedResponse).length === 2) {
                        content.innerHTML = JSON.stringify(parsedResponse);
                    } else {
                        // if longer, assume list + only print char name
                        for (const char in parsedResponse) {
                            content.innerHTML += ` ${parsedResponse[char].name}<br>`
                        }
                    }
                    break;
                case 201:
                    content.innerHTML = '<b>Character Created!</b>';
                    break;
                case 204:
                    content.innerHTML = '<b>Character Updated!</b>';
                    break;
                case 400:
                    content.innerHTML = `<b>Bad Request</b>`;
                    break;
                case 404:
                default:
                    content.innerHTML = `<b>Not Found</b>`;
                    break;
            }

            if (response.status !== 204) {
                console.log(parsedResponse);
            }
        };

        // get/head requests
        const sendGetHead = async (div, section, param) => {
            let url = div.getAttribute('action');
            if (param) {
                url += `?${param}`;
            }
            const method = div.getAttribute('method');
            let response = await fetch(url, {
                method: method,
                headers: {
                    'Accept': 'application/json',
                },
            });

            response.method = method;
            handleResponse(response, section);
        };

        // post
        const sendPost = async (div, section) => {
            const url = div.getAttribute('action');
            const method = div.getAttribute('method');

            const nameField = div.querySelector('#name');
            const visionField = div.querySelector('#vision');
            const weaponField = div.querySelector('#weapon');
            const regionField = div.querySelector('#region');
            const rarityField = div.querySelector('#rarity');
            const basicField = div.querySelector('#basic');
            const skillField = div.querySelector('#skill');
            const burstField = div.querySelector('#burst');

            const formData = `name=${nameField.value}
            &vision=${visionField.value}
            &weapon=${weaponField.value}
            &region=${regionField.value}
            &rarity=${rarityField.value}
            &basic=${basicField.value}
            &skill=${skillField.value}
            &burst=${burstField.value}`;

            let response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Accept': 'application/json',
                },
                body: formData,
            });
            handleResponse(response, section);
        };

        // setup for init
        const init = () => {
            // elems for random
            const randomDiv = document.querySelector('#randomGet1');
            const randomButton = document.querySelector('#sendRandom')
            // for vision
            const visionDiv = document.querySelector('#visionGet2');
            const visionSelect = document.querySelector('#vision');
            const visionButton = document.querySelector('#sendVisionList');
            // for name
            const talentDiv = document.querySelector('#talentsGet3');
            const talentField = document.querySelector('#nameLine');
            const talentButton = document.querySelector('#sendTalent');
            // for region
            const regionDiv = document.querySelector('#regionGet4');
            const regionSelect = document.querySelector('#region');
            const regionButton = document.querySelector('#sendRegionList');
            // for adding chars
            const addCharDiv = document.querySelector('#characterAddPost1');
            const addCharButton = document.querySelector('#sendCharacter');
            // for editing
            const editCharDiv = document.querySelector('#characterEditPost2');
            const editCharButton = document.querySelector('#updateCharacter');

            // PREVENT DEFAULT ACTIONS FOR EACH METHOD
            // get/head funcs
            const fetchRandom = (e) => {
                e.preventDefault();
                sendGetHead(randomDiv, '#content1');
                return false;
            };

            const fetchVision = (e) => {
                e.preventDefault();
                sendGetHead(visionDiv, '#content2', `vision=${visionSelect.value}`);
                return false;
            };

            const fetchTalents = (e) => {
                e.preventDefault();
                sendGetHead(talentDiv, '#content3', `name=${talentField.value}`);
                return false;
            }

            const fetchRegion = (e) => {
                e.preventDefault();
                sendGetHead(regionDiv, '#content4', `region=${regionSelect.value}`);
                return false;
            };

            // post
            const addChar = (e) => {
                e.preventDefault();
                sendPost(addCharDiv, '#content5');
                return false;
            };

            const editChar = (e) => {
                e.preventDefault();
                sendPost(editCharDiv, '#content6');
                return false;
            };

            // listener connectors
            // random
            randomButton.addEventListener('click', fetchRandom);
            // vision
            visionButton.addEventListener('click', fetchVision);
            // name
            talentButton.addEventListener('click', fetchTalents);
            // region
            regionButton.addEventListener('click', fetchRegion);
            // add char
            addCharButton.addEventListener('click', addChar);
            // edit char
            editCharButton.addEventListener('click', editChar);
        };

        window.onload = init;
    </script>
</head>

<body>
    <h1>Genshin Impact API</h1>

    <div id="randomGet1" action="/getRandom" method="GET">
        <h2>Random Character Information</h2>
        <p>Generate information about a random character.</p>
        <small>Fun game: Let the RNG gods decide your next main. Ehehe~</small><br><br>
        <button id="sendRandom">Get Character Info</button><br>
        <section id="content1">
        </section>
    </div>

    <div id="visionGet2" action="/getVisions" method="GET">
        <h2>Vision Roster</h2>
        <p>See all characters of a specific Vision.</p>
        <select id="vision">
            <option value="pyro">Pyro (Fire)</option>
            <option value="hydro">Hydro (Water)</option>
            <option value="anemo">Anemo (Wind)</option>
            <option value="electro">Electro (Electricity)</option>
            <option value="dendro">Dendro (Life/Plant)</option>
            <option value="cryo">Cryo (Ice)</option>
            <option value="geo">Geo (Earth)</option>
        </select>
        <button id="sendVisionList">Get Characters</button><br>
        <section id="content2">
        </section>
    </div>

    <div id="talentsGet3" action="/getTalents" method="GET">
        <h2>View Talents</h2>
        <p>Enter a character name to see their talents.</p>
        <label>Name:</label>
        <input id="nameLine" type="text" name="name" />
        <button id="sendTalent">Get Talents</button><br>
        <small>*Recommended: Use given/first name, not family name. Either works but it gets a little funky with the
            Inazumans/siblings.</small>
        <section id="content3">
        </section>
    </div>

    <div id="regionGet4" action="/getRegion" method="GET">
        <h2>Regional Roster</h2>
        <p>Select a region to view all characters who reside there.</p>
        <select id="region">
            <option value="Mondstadt">Mondstadt</option>
            <option value="Liyue">Liyue</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Natlan">Natlan</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="Other">Other/Unaligned</option>
        </select>
        <button id="sendRegionList">Get Regional Characters</button><br>
        <small>*Note: Characters categorized by their Vision's region, not necessarily their
            birth/residency.</small><br>
        <section id="content4">
        </section>
    </div>

    <div id="characterAddPost1" action="/addChar" method="POST">
        <h2>Create a Character</h2>
        <label>Character Details </label><br>
        <label>Name: </label>
        <input id="name" type="text" newName="newName" /><br>
        <label>Vision: </label>
        <select id="vision" vision="vision">
            <option value="Pyro">Pyro (Fire)</option>
            <option value="Hydro">Hydro (Water)</option>
            <option value="Anemo">Anemo (Wind)</option>
            <option value="Electro">Electro (Electricity)</option>
            <option value="Dendro">Dendro (Life/Plant)</option>
            <option value="Cryo">Cryo (Ice)</option>
            <option value="Geo">Geo (Earth)</option>
        </select>
        <label>Weapon: </label>
        <select id="weapon" weapon="weapon">
            <option value="Sword">Sword</option>
            <option value="Polearm">Polearm</option>
            <option value="Claymore">Claymore</option>
            <option value="Catalyst">Catalyst</option>
            <option value="Bow">Bow</option>
        </select>
        <label>Region: </label>
        <select id="region" region="region">
            <option value="Natlan">Natlan</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Mondstadt">Mondstadt</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="Liyue">Liyue</option>
        </select>
        <label>Rarity (star count): </label>
        <input id="rarity" type="number" min="4" max="5" step="1" rarity="rarity" />
        <hr>
        <label>Assign Talents </label><br>
        <label>Basic: </label>
        <input id="basic" type="text" basic="basic" />
        <label>Skill: </label>
        <input id="skill" type="text" skill="skill" />
        <label>Burst: </label>
        <input id="burst" type="text" burst="burst" />
        <button id="sendCharacter">Submit Character</button><br>
        <section id="content5">
        </section>
    </div>

    <div id="characterEditPost2" action="/editChar" method="POST">
        <h2>Edit Existing Character</h2>
        <label>Character Details </label><br>
        <label>Name: </label>
        <input id="name" type="text" newName="editName" /><br>
        <label>Vision: </label>
        <select id="vision" vision="editVision">
            <option value="pyro">Pyro (Fire)</option>
            <option value="hydro">Hydro (Water)</option>
            <option value="anemo">Anemo (Wind)</option>
            <option value="electro">Electro (Electricity)</option>
            <option value="dendro">Dendro (Life/Plant)</option>
            <option value="cryo">Cryo (Ice)</option>
            <option value="geo">Geo (Earth)</option>
        </select>
        <label>Weapon: </label>
        <select id="weapon" weapon="editWeapon">
            <option value="Sword">Sword</option>
            <option value="Polearm">Polearm</option>
            <option value="Claymore">Claymore</option>
            <option value="Catalyst">Catalyst</option>
            <option value="Bow">Bow</option>
        </select>
        <label>Region: </label>
        <select id="region" region="editRegion">
            <option value="Natlan">Natlan</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Mondstadt">Mondstadt</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="Liyue">Liyue</option>
        </select>
        <label>Rarity (star count): </label>
        <input id="rarity" type="number" min="4" max="5" step="1" rarity="editRarity" />
        <hr>
        <label>Assign Talents </label><br>
        <label>Basic: </label>
        <input id="basic" type="text" basic="editBasic" />
        <label>Skill: </label>
        <input id="skill" type="text" skill="editSkill" />
        <label>Burst: </label>
        <input id="burst" type="text" burst="editBurst" />
        <button id="updateCharacter">Update Character</button><br>
        <section id="content6">
        </section>
    </div>

</body>

</html>