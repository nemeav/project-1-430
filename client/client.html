<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1 Milestone</title>

    <script>
        // fetch
        const handleResponse = async (response, section) => {
            const content = document.querySelector(`${section}`);
            const resText = await response.text();
            // handle page based on response
            const parsedResponse = JSON.parse(resText);
            //only show users for /getUsers + GET
            if (response.method !== 'HEAD' && response.status === 200) {
                content.innerHTML += `<p>${JSON.stringify(parsedResponse.users)}</p>`;
            }
            if (parsedResponse.message) {
                content.innerHTML += `<p>Message: ${parsedResponse.message}</p>`;
            }

            console.log(parsedResponse);

            // clear for clarity - not sure if necessary though...
            content.innerHTML = '';

            // header titles based on status code
            switch (response.status) {
                case 200:
                    if (Object.keys(parsedResponse).length === 7) {
                        content.innerHTML = JSON.stringify(parsedResponse);
                        console.log(Object.keys(parsedResponse).length)
                    } else {
                        for (const char in parsedResponse) {
                            content.innerHTML += ` ${parsedResponse[char].name},<br>`
                        }
                    }
                    console.log("Done")
                    break;
                case 201:
                    content.innerHTML = '<b>Created</b>';
                    break;
                case 204:
                    content.innerHTML = '<b>Updated (No Content)</b>';
                    return;
                case 400:
                    content.innerHTML = `<b>Bad Request</b>`;
                    break;
                case 404:
                default:
                    content.innerHTML = `<b>Not Found</b>`;
                    break;
            }
        };

        // get/head requests
        const sendGetHead = async (div, section, formData) => {
            let url = div.getAttribute('action');
            if (formData) {
                url += `?${formData}`;
            }
            const method = div.getAttribute('method');
            let response = await fetch(url, {
                method: method,
                headers: {
                    'Accept': 'application/json',
                },
            });

            response.method = method;
            handleResponse(response, section);
        };

        // // manage post
        // const sendPost = async (nameForm) => {
        //     const url = nameForm.getAttribute('action');
        //     const method = nameForm.getAttribute('method');

        //     const nameField = nameForm.querySelector('#nameField');
        //     const ageField = nameForm.querySelector('#ageField');

        //     const formData = `name=${nameField.value}&age=${ageField.value}`;

        //     let response = await fetch(url, {
        //         method: method,
        //         headers: {
        //             'Content-Type': 'application/x-www-form-urlencoded',
        //             'Accept': 'application/json',
        //         },
        //         body: formData,
        //     });

        //     handleResponse(response);
        // };

        // setup for init
        const init = () => {
            // elems for random
            const randomDiv = document.querySelector('#randomGet1');
            const randomButton = document.querySelector('#sendRandom')
            // for vision
            const visionDiv = document.querySelector('#visionGet2');
            const visionSelect = document.querySelector('#vision');
            const visionButton = document.querySelector('#sendVisionList');

            // PREVENT DEFAULT ACTIONS FOR EACH METHOD
            // get/head funcs
            const fetchRandom = (e) => {
                e.preventDefault();
                sendGetHead(randomDiv, '#content1');
                return false;
            };

            const fetchVision = (e) => {
                e.preventDefault();
                sendGetHead(visionDiv, '#content2', `vision=${visionSelect.value}`);
                return false;
            };

            // // post
            // const addUser = (e) => {
            //     e.preventDefault();
            //     sendPost(nameForm);
            //     return false;
            // };

            // listener connectors
            // random
            randomDiv.addEventListener('submit', fetchRandom);
            randomButton.addEventListener('click', fetchRandom);
            // vision
            visionSelect.addEventListener('submit', fetchVision);
            visionButton.addEventListener('click', fetchVision);
        };

        window.onload = init;
    </script>
</head>

<body>
    <h1>Genshin Impact API</h1>

    <div id="randomGet1" action="/getRandom" method="GET">
        <h2>Random Character Information</h2>
        <p>Generate information about a random character.</p>
        <small>Fun game: Let the RNG gods decide your next main. Ehehe~</small><br><br>
        <button id="sendRandom">Get Character Info</button>
        <section id="content1">
        </section>
    </div>

    <div id="visionGet2" action="/getVisions" method="GET">
        <h2>Vision Roster (GET 2)</h2>
        <p>See all characters of a specific Vision.</p>
        <select id="vision">
            <option value="pyro">Pyro (Fire)</option>
            <option value="hydro">Hydro (Water)</option>
            <option value="anemo">Anemo (Wind)</option>
            <option value="electro">Electro (Electricity)</option>
            <option value="dendro">Dendro (Life/Plant)</option>
            <option value="cryo">Cryo (Ice)</option>
            <option value="geo">Geo (Earth)</option>
        </select>
        <button id="sendVisionList">Get Characters</button>
        <section id="content2">
        </section>
    </div>

    <div id="talentsGet3">
        <h2>View Talents (GET 3)</h2>
        <p>Enter a character name to see their talents.</p>
        <label>Name:</label>
        <input id="nameField" type="text" name="name" />
        <button id="sendTalent">Get Talents</button><br>
        <small>*Recommended: Use given/first name, not the family name. Either works but it gets a little funky with the
            Inazuman siblings/characters.</small>
    </div>

    <div id="regionGet4">
        <h2>Regional Roster (GET 4)</h2>
        <p>Select a region to view all characters who reside there.</p>
        <select id="region">
            <option value="Mondstadt">Mondstadt</option>
            <option value="Liyue">Liyue</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Natlan">Natlan</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="other">Other/Unaligned</option>
        </select>
        <button id="sendRegion">Get Regional Characters</button><br>
        <small>*Please note: Characters are categorized by the region's Vision they hold, not necessarily their
            birth/residency.</small>
    </div>

    <div id="characterAddPost1">
        <h2>Create a New Character (POST 1)</h2>
        <label>Character Details </label><br>
        <label>Name: </label>
        <input id="name" type="text" newName="newName" /><br>
        <label>Vision: </label>
        <select id="vision" vision="vision">
            <option value="pyro">Pyro (Fire)</option>
            <option value="hydro">Hydro (Water)</option>
            <option value="anemo">Anemo (Wind)</option>
            <option value="electro">Electro (Electricity)</option>
            <option value="dendro">Dendro (Life/Plant)</option>
            <option value="cryo">Cryo (Ice)</option>
            <option value="geo">Geo (Earth)</option>
        </select>
        <label>Weapon: </label>
        <select id="weapon" weapon="weapon">
            <option value="Sword">Sword</option>
            <option value="Polearm">Polearm</option>
            <option value="Claymore">Claymore</option>
            <option value="Catalyst">Catalyst</option>
            <option value="Bow">Bow</option>
        </select>
        <label>Region: </label>
        <select id="region" region="region">
            <option value="Natlan">Natlan</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Mondstadt">Mondstadt</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="Liyue">Liyue</option>
        </select>
        <label>Rarity (star count): </label>
        <input id="rarity" type="number" min="4" max="5" step="1" rarity="rarity" />
        <hr>
        <label>Assign Talents </label><br>
        <label>Basic: </label>
        <input id="basic" type="text" basic="basic" />
        <label>Skill: </label>
        <input id="skill" type="text" skill="skill" />
        <label>Burst: </label>
        <input id="burst" type="text" burst="burst" />
        <button id="sendCharacter">Submit Character</button>
    </div>

    <div id="characterEditPost2">
        <h2>Edit Existing Character (POST 2)</h2>
        <label>Character Details </label><br>
        <label>Name: </label>
        <input id="name" type="text" newName="editName" /><br>
        <label>Vision: </label>
        <select id="vision" vision="editVision">
            <option value="pyro">Pyro (Fire)</option>
            <option value="hydro">Hydro (Water)</option>
            <option value="anemo">Anemo (Wind)</option>
            <option value="electro">Electro (Electricity)</option>
            <option value="dendro">Dendro (Life/Plant)</option>
            <option value="cryo">Cryo (Ice)</option>
            <option value="geo">Geo (Earth)</option>
        </select>
        <label>Weapon: </label>
        <select id="weapon" weapon="editWeapon">
            <option value="Sword">Sword</option>
            <option value="Polearm">Polearm</option>
            <option value="Claymore">Claymore</option>
            <option value="Catalyst">Catalyst</option>
            <option value="Bow">Bow</option>
        </select>
        <label>Region: </label>
        <select id="region" region="editRegion">
            <option value="Natlan">Natlan</option>
            <option value="Fontaine">Fontaine</option>
            <option value="Mondstadt">Mondstadt</option>
            <option value="Inazuma">Inazuma</option>
            <option value="Sumeru">Sumeru</option>
            <option value="Snezhnaya">Snezhnaya</option>
            <option value="Liyue">Liyue</option>
        </select>
        <label>Rarity (star count): </label>
        <input id="rarity" type="number" min="4" max="5" step="1" rarity="editRarity" />
        <hr>
        <label>Assign Talents </label><br>
        <label>Basic: </label>
        <input id="basic" type="text" basic="editBasic" />
        <label>Skill: </label>
        <input id="skill" type="text" skill="editSkill" />
        <label>Burst: </label>
        <input id="burst" type="text" burst="editBurst" />
        <button id="sendCharacter">Update Character</button>
    </div>

</body>

</html>